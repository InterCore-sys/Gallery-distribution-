<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery OS | GNU/Arduino & Pi</title>
    <style>
        /* FUTURA Styles Integration */
        :root {
            --bg-color-futura: linear-gradient(135deg, #000000, #1a1a2e, #3a0ca3);
            --card-bg-futura: rgba(255, 255, 255, 0.05);
            --border-color-futura: rgba(180, 0, 255, 0.3);
            --accent-color-futura: #bb86fc;
            --terminal-green: #2ea043; /* Keeping original terminal color */
            --text-color: #c9d1d9; /* Base text color */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            /* Futuristic Gradient Background */
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg-color-futura);
            color: #fff; /* Set general text to white for contrast */
            min-height: 100vh;
            line-height: 1.6;
        }
        
        /* --- Header & Hero --- */
        header {
            padding: 2rem 1rem;
            text-align: center;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: var(--accent-color-futura); /* Neon Title Color */
        }

        .tagline {
            color: var(--text-color);
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.1rem;
        }

        /* --- Terminal Window Effect (Glassmorphism card) --- */
        .terminal-window {
            background: var(--card-bg-futura);
            backdrop-filter: blur(10px); /* Glassmorphism effect */
            border: 1px solid var(--border-color-futura);
            border-radius: 12px; /* Smoother edges */
            max-width: 800px;
            margin: 2rem auto;
            box-shadow: 0 0 30px rgba(187, 134, 252, 0.2);
            text-align: left;
            overflow: hidden;
        }

        .terminal-header {
            background: rgba(0, 0, 0, 0.3);
            padding: 5px 15px;
            display: flex;
            gap: 8px;
            border-bottom: 1px solid var(--border-color-futura);
        }

        .dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; }
        .red { background: #ff5f56; }
        .yellow { background: #ffbd2e; }
        .green { background: #27c93f; }

        .terminal-body {
            padding: 20px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem;
            color: #fff; 
            white-space: pre-wrap;
        }

        .prompt { color: var(--terminal-green); }
        .cursor { display: inline-block; width: 8px; height: 18px; background: #fff; animation: blink 1s infinite; vertical-align: middle; }

        @keyframes blink { 50% { opacity: 0; } }

        /* --- Content Sections --- */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        h2 {
            font-size: 1.75rem;
            color: var(--accent-color-futura);
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--accent-color-futura);
            padding-left: 10px;
        }
        
        /* --- Feature List (Glassmorphism card) --- */
        .feature-item {
            background: var(--card-bg-futura);
            backdrop-filter: blur(5px);
            border: 1px solid var(--border-color-futura);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .feature-item h3 { color: var(--accent-color-futura); margin-bottom: 8px; }

        .feature-item ul {
            list-style-type: none;
            padding-left: 15px;
        }

        .feature-item ul li::before {
            content: '>';
            color: var(--terminal-green);
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
        }

        /* --- Download Section (Glassmorphism card) --- */
        .download-group {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 3rem;
        }
        
        .download-section {
            text-align: center;
            padding: 2rem;
            background: var(--card-bg-futura);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid var(--accent-color-futura);
            flex: 1 1 350px;
            box-shadow: 0 0 20px rgba(187, 134, 252, 0.4);
        }
        
        .download-section h3 {
            margin-bottom: 10px;
            color: var(--accent-color-futura);
        }

        .btn {
            display: inline-block;
            background: linear-gradient(90deg, #bb86fc, #ff4ecd); /* FUTURA Button Gradient */
            color: #fff;
            padding: 15px 30px;
            font-size: 1.2rem;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.3s;
            border: none;
            margin-top: 1rem;
            box-shadow: 0 0 20px rgba(187, 134, 252, 0.6);
        }

        .btn:hover {
            background: linear-gradient(90deg, #ff4ecd, #bb86fc); /* Reverse Gradient on Hover */
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(255, 78, 205, 0.8);
        }

        .note {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-left: 3px solid var(--accent-color-futura);
            margin: 2rem 0;
            font-size: 0.95rem;
            border-radius: 6px;
        }
        
        .disclaimer {
            font-size: 0.85rem;
            color: #aaa;
            text-align: center;
            padding: 1rem;
            border-top: 1px solid rgba(180, 0, 255, 0.3);
            margin-top: 2rem;
        }
        
        hr {
            border: none;
            border-top: 1px solid rgba(187, 134, 252, 0.2);
            margin: 3rem 0;
        }
    </style>
</head>
<body>

    <header>
        <h1>Gallery OS</h1>
        <p class="tagline">GNU/Arduino & Raspberry Pi Shell Environment</p>
    </header>

    <div class="container">
        
        <!-- Terminal Simulation (Glassmorphism Card) -->
        <div class="terminal-window">
            <div class="terminal-header">
                <span class="dot red"></span>
                <span class="dot yellow"></span>
                <span class="dot green"></span>
            </div>
            <div class="terminal-body">
                <div>Bootsrap Loader v1.0.4</div>
                <div>Loading Kernel modules... [OK]</div>
                <div>Mounting filesystem... [OK]</div>
                <div>Starting Firewall Service... [OK]</div>
                <br>
                <div>Welcome to Gallery OS (GNU/Arduino)</div>
                <div>System is ready.</div>
                <br>
                <span class="prompt">admin@gallery:/home/admin$</span> <span class="cursor"></span>
            </div>
        </div>
        
        <hr>

        <section id="features">
            <h2>Key Features</h2>
            
            <div class="feature-item">
                <h3>1. Bootstrap System</h3>
                <p>When you reset the **Arduino** or launch the Python script on the **Pi**, you will see a text-based startup sequence loading fake "kernel modules," giving the **authentic feel of a server booting up**.</p>
            </div>
            
            <div class="feature-item">
                <h3>2. The Terminal (CLI)</h3>
                <p>It uses a standard **admin@gallery:/home/admin$** prompt. It parses text strings so you can type natural commands.</p>
            </div>

            <div class="feature-item">
                <h3>3. Firewall (FW) Simulation</h3>
                <ul>
                    <li>**FW STATUS**: Shows active rules.</li>
                    <li>**FW BLOCK <IP>**: Adds an IP address to the mock blocklist.</li>
                </ul>
            </div>
            
            <div class="feature-item">
                <h3>4. Password Manager (PM)</h3>
                <ul>
                    <li>**PM ADD <SITE> <USER> <PASS>**: Stores credentials.</li>
                    <li>**PM LIST**: Lists stored sites (hiding the actual password for "security").</li>
                </ul>
            </div>
            
            <div class="feature-item">
                <h3>5. Backup System (Backup)</h3>
                <p>Visualizes a progress bar and simulates a system dump.</p>
            </div>

            <div class="note">
                **IMPORTANT NOTE ON DATA:** On Arduino, data is stored in **RAM** and resets on power loss. On Raspberry Pi, data is stored persistently using a **JSON file** (<code>gallery_os_data.json</code>).
            </div>
        </section>

        <hr>

        <section id="arduino-devices">
            <h2>1. For Arduino R4 Boards</h2>
            <p>This firmware is compiled C++ code for the microcontroller.</p>
            
            <div class="feature-item">
                <h3>Supported Hardware</h3>
                <p>Arduino UNO R4 WIFI</p>
                <p>Arduino NANO R4</p>
            </div>
            
            <div class="download-group">
                <div class="download-section">
                    <h3>Download Firmware Code</h3>
                    <p>The core C++ code (.ino file) for Gallery OS.</p>
                    <button class="btn" onclick="downloadCode('firmware')">Download GalleryOS.ino</button>
                </div>
                
                <div class="download-section">
                    <h3>Download Setup Guide</h3>
                    <p>Detailed steps for Arduino setup and use (Text format).</p>
                    <button class="btn" onclick="downloadCode('guide')">Download Setup Guide</button>
                </div>
            </div>
        </section>
        
        <hr>

        <section id="pi-devices">
            <h2>2. For Raspberry Pi (All Models)</h2>
            <p>This version uses Python to run natively on Raspberry Pi OS or any other Pi distribution, offering persistent data storage.</p>
            
            <div class="feature-item">
                <h3>Supported Hardware</h3>
                <p>Raspberry Pi 5, 4, 3, Zero W, etc.</p>
            </div>
            
            <div class="download-group">
                <div class="download-section">
                    <h3>Download Python App</h3>
                    <p>The Python script (.py file) for Gallery OS on Pi.</p>
                    <button class="btn" onclick="downloadCode('pi_app')">Download gallery_pi.py</button>
                </div>
                
                <div class="download-section">
                    <h3>Download Pi Setup Guide</h3>
                    <p>Instructions for running the Python app on your Pi.</p>
                    <button class="btn" onclick="downloadCode('pi_guide')">Download Pi Guide</button>
                </div>
            </div>
        </section>
        
        <p class="disclaimer">Terms & conditions: The Gallery team isn't liable for any loss of data. The system is not for high responsibility, only educational environments.</p>

    </div>

    <!-- 
        ========================================================
        RAW DATA STORAGE FOR DOWNLOADS (Hidden from view)
        ========================================================
    -->

    <!-- C++ FIRMWARE CODE (Arduino) -->
    <textarea id="hidden-code-firmware" style="display:none;">
/*
  Gallery OS - Linux-like Shell Environment for Arduino R4
  Target Hardware: Arduino Uno R4 (Minima/WiFi), Arduino Nano R4
   
  Features:
  - Bootstrap sequence
  - Command Line Interface (CLI)
  - Simulated Firewall
  - In-Memory Password Manager
  - Mock Backup System
   
  Note: This is a bare-metal firmware that mimics Linux behavior.
  It does not use a Linux kernel due to hardware constraints (No MMU, limited RAM).
*/

#include <Arduino.h>

// --- Configuration ---
#define HOSTNAME "gallery"
#define USER "admin"
#define BAUD_RATE 115200
#define MAX_PASSWORDS 10
#define MAX_BLOCKED_IPS 10

// --- Data Structures ---

struct PasswordEntry {
  String site;
  String username;
  String password;
  bool active;
};

struct FirewallRule {
  String ip;
  bool active;
};

// --- Globals ---
PasswordEntry passwordStore[MAX_PASSWORDS];
FirewallRule blockedIPs[MAX_BLOCKED_IPS];
bool isLoggedIn = false;
String currentDir = "/home/admin";

// --- Function Prototypes ---
void runBootstrap();
void displayPrompt();
void processCommand(String input);
void cmdHelp();
void cmdFirewall(String args);
void cmdPassMan(String args);
void cmdBackup();
void cmdClear();
void cmdUptime();

void setup() {
  Serial.begin(BAUD_RATE);
  while (!Serial) {
    ; // Wait for serial port to connect
  }
   
  // Initialize data
  blockedIPs[0] = {"192.168.1.55", true}; // Default rule
   
  runBootstrap();
}

void loop() {
  if (Serial.available() > 0) {
    String input = Serial.readStringUntil('\n');
    input.trim();
    if (input.length() > 0) {
      Serial.println(input); // Echo command
      processCommand(input);
      displayPrompt();
    }
  }
}

// --- Bootstrap System ---
void runBootstrap() {
  Serial.println("\033[2J\033[H"); // ANSI Clear Screen
  Serial.println(F("Bootsrap Loader v1.0.4"));
  delay(500);
  Serial.print(F("Loading Kernel modules..."));
  delay(800);
  Serial.println(F(" [OK]"));
  Serial.print(F("Mounting filesystem..."));
  delay(600);
  Serial.println(F(" [OK]"));
  Serial.print(F("Starting Firewall Service..."));
  delay(400);
  Serial.println(F(" [OK]"));
  Serial.print(F("Initializing Password Vault..."));
  delay(400);
  Serial.println(F(" [OK]"));
   
  Serial.println(F("\nWelcome to Gallery OS (GNU/Arduino)"));
  Serial.println(F("System is ready. Type 'help' for available commands.\n"));
   
  displayPrompt();
}

void displayPrompt() {
  Serial.print(USER);
  Serial.print("@");
  Serial.print(HOSTNAME);
  Serial.print(":");
  Serial.print(currentDir);
  Serial.print("$ ");
}

// --- Terminal / Command Parser ---
void processCommand(String input) {
  int spaceIndex = input.indexOf(' ');
  String cmd = (spaceIndex == -1) ? input : input.substring(0, spaceIndex);
  String args = (spaceIndex == -1) ? "" : input.substring(spaceIndex + 1);

  if (cmd == "help") cmdHelp();
  else if (cmd == "clear") cmdClear();
  else if (cmd == "fw") cmdFirewall(args);
  else if (cmd == "pm") cmdPassMan(args);
  else if (cmd == "backup") cmdBackup();
  else if (cmd == "uptime") cmdUptime();
  else if (cmd == "ls") Serial.println(F("passwords.db  config.sys  firewall.rules"));
  else if (cmd == "reboot") { Serial.println(F("Rebooting...")); delay(1000); runBootstrap(); }
  else {
    Serial.print(F("gallery: command not found: "));
    Serial.println(cmd);
  }
}

void cmdHelp() {
  Serial.println(F("GNU/Arduino Gallery OS Commands:"));
  Serial.println(F("  fw [status|block <ip>]   : Manage Firewall"));
  Serial.println(F("  pm [list|add <site> <u/p>] : Password Manager"));
  Serial.println(F("  backup                   : Run system backup"));
  Serial.println(F("  uptime                   : System uptime"));
  Serial.println(F("  clear                    : Clear terminal"));
  Serial.println(F("  reboot                   : Restart system"));
}

void cmdFirewall(String args) {
  if (args == "" || args == "status") {
    Serial.println(F("--- Firewall Status: ACTIVE ---"));
    Serial.println(F("Policy: ALLOW ALL incoming"));
    Serial.println(F("Blocked IPs:"));
    bool found = false;
    for (int i = 0; i < MAX_BLOCKED_IPS; i++) {
      if (blockedIPs[i].active) {
        Serial.print(F("  [DROP] "));
        Serial.println(blockedIPs[i].ip);
        found = true;
      }
    }
    if (!found) Serial.println(F("  (None)"));
  } else if (args.startsWith("block ")) {
    String ip = args.substring(6);
    for (int i = 0; i < MAX_BLOCKED_IPS; i++) {
      if (!blockedIPs[i].active) {
        blockedIPs[i].ip = ip;
        blockedIPs[i].active = true;
        Serial.print(F("Firewall: Added rule to DROP "));
        Serial.println(ip);
        return;
      }
    }
    Serial.println(F("Firewall: Rule table full."));
  } else {
    Serial.println(F("Usage: fw [status | block <ip>]"));
  }
}

void cmdPassMan(String args) {
  if (args == "" || args == "list") {
    Serial.println(F("--- Password Vault ---"));
    bool found = false;
    for (int i = 0; i < MAX_PASSWORDS; i++) {
      if (passwordStore[i].active) {
        Serial.print(i);
        Serial.print(F(": "));
        Serial.print(passwordStore[i].site);
        Serial.print(F(" | "));
        Serial.println("********"); // Security feature: don't show pass on list
        found = true;
      }
    }
    if (!found) Serial.println(F("  (Vault empty)"));
  } else if (args.startsWith("add ")) {
    // Expected format: pm add google myUser myPass
    int firstSpace = args.indexOf(' ');
    int secondSpace = args.indexOf(' ', firstSpace + 1);
    int thirdSpace = args.indexOf(' ', secondSpace + 1);
     
    if (firstSpace == -1 || secondSpace == -1 || thirdSpace == -1) {
       Serial.println(F("Usage: pm add <site> <user> <pass>"));
       return;
    }

    String site = args.substring(4, secondSpace);
    String user = args.substring(secondSpace + 1, thirdSpace);
    String pass = args.substring(thirdSpace + 1);

    for (int i = 0; i < MAX_PASSWORDS; i++) {
      if (!passwordStore[i].active) {
        passwordStore[i].site = site;
        passwordStore[i].username = user;
        passwordStore[i].password = pass;
        passwordStore[i].active = true;
        Serial.print(F("PassMan: Credentials saved for "));
        Serial.println(site);
        return;
      }
    }
    Serial.println(F("PassMan: Storage full."));
  } else {
    Serial.println(F("Usage: pm [list | add <site> <user> <pass>]"));
  }
}

void cmdBackup() {
  Serial.println(F("Starting System Backup..."));
  Serial.println(F("[....................] 0%"));
  delay(300);
  Serial.println(F("[#####...............] 25% - Compressing logs"));
  delay(500);
  Serial.println(F("[##########..........] 50% - Encrypting vault"));
  delay(400);
  Serial.println(F("[###############.....] 75% - Uploading to serial"));
  delay(300);
  Serial.println(F("[####################] 100%"));
  Serial.println(F("Backup Complete. Snapshot hash: 8f4a2c91"));
  Serial.println(F("Backup saved to local storage simulation."));
}

void cmdClear() {
  Serial.println("\033[2J\033[H");
}

void cmdUptime() {
  unsigned long runMillis = millis();
  unsigned long allSeconds = runMillis / 1000;
  int runHours = allSeconds / 3600;
  int runMinutes = (allSeconds % 3600) / 60;
  int runSeconds = allSeconds % 60;

  Serial.print(F("up "));
  Serial.print(runHours);
  Serial.print(F(":"));
  if (runMinutes < 10) Serial.print("0");
  Serial.print(runMinutes);
  Serial.print(F(":"));
  if (runSeconds < 10) Serial.print("0");
  Serial.println(runSeconds);
}
    </textarea>
    
    <!-- SETUP GUIDE CONTENT (Arduino) -->
    <textarea id="hidden-code-guide" style="display:none;">
SETUP INSTRUCTIONS FOR GALLERY OS (Arduino R4)

SUPPORTED DEVICES:
* Arduino UNO R4 WIFI
* Arduino NANO R4

SETUP INSTRUCTIONS:
1. Open the Arduino IDE.
2. Select your board (Arduino UNO R4 WIFI/Minima or NANO R4).
3. Copy the code from the 'GalleryOS.ino' file into a new sketch.
4. Upload it to the board.
5. Open the Serial Monitor (Tools > Serial Monitor).
6. Set the Baud Rate to 115200 and Line Ending to Newline.

KEY FEATURES OF GALLERY OS:
1. BOOTSTRAP SYSTEM: When you reset the Arduino, you will see a text-based startup sequence loading fake "kernel modules."
2. THE TERMINAL: Uses the admin@gallery:/home/admin$ prompt.
3. FIREWALL (FW): Manage rules with FW STATUS and FW BLOCK <IP>.
4. PASSWORD MANAGER (PM): Manage credentials with PM ADD and PM LIST.
5. BACKUP SYSTEM (BACKUP): Simulates a system dump.

NOTE: Data is stored in RAM and will reset if the board loses power.

Terms & conditions: The Gallery team isn't liable for any loss of data. The system is not for high responsibility, only educational environments.
    </textarea>
    
    <!-- PYTHON APP CODE (Raspberry Pi) -->
    <textarea id="hidden-code-pi-app" style="display:none;">
import time
import os
import json
import getpass
from datetime import timedelta

# --- Configuration ---
HOSTNAME = "gallery-pi"
USER = getpass.getuser() # Uses the current logged-in user (e.g., 'pi')
CONFIG_FILE = "gallery_os_data.json"
MAX_PASSWORDS = 10
MAX_BLOCKED_IPS = 10

# --- Data Structures ---
DEFAULT_DATA = {
    "passwordStore": [],
    "blockedIPs": [{"ip": "192.168.1.55", "active": True}],
    "startup_time": 0
}

# --- Utility Functions for Persistence ---

def load_data():
    """Loads application data from a JSON file, or creates defaults if missing."""
    global DEFAULT_DATA
    try:
        with open(CONFIG_FILE, 'r') as f:
            data = json.load(f)
            # Ensure required keys exist in case of incomplete save
            for key in DEFAULT_DATA:
                if key not in data:
                    data[key] = DEFAULT_DATA[key]
            return data
    except (FileNotFoundError, json.JSONDecodeError):
        # Initialize startup time on first run or failure
        DEFAULT_DATA['startup_time'] = time.time()
        return DEFAULT_DATA

def save_data(data):
    """Saves application data to a JSON file."""
    try:
        with open(CONFIG_FILE, 'w') as f:
            json.dump(data, f, indent=4)
    except IOError as e:
        print(f"Error saving data: {e}")

# --- Globals ---
app_data = load_data()

# --- Shell Functions ---

def clear_screen():
    """Clears the terminal screen."""
    os.system('cls' if os.name == 'nt' else 'clear')

def run_bootstrap():
    """Simulates the Linux boot sequence."""
    clear_screen()
    print("Bootsrap Loader v1.0.4")
    time.sleep(0.5)
    print("Loading Kernel modules... [OK]")
    time.sleep(0.8)
    print("Mounting filesystem... [OK]")
    time.sleep(0.6)
    print("Starting Firewall Service... [OK]")
    time.sleep(0.4)
    print("Initializing Persistent Vault... [OK]")
    time.sleep(0.4)
    
    # Save the official startup time if it wasn't loaded from disk
    if app_data['startup_time'] == 0:
        app_data['startup_time'] = time.time()
        save_data(app_data)
    
    print("\nWelcome to Gallery OS (GNU/Pi)")
    print(f"System is ready. Persistent data loaded from {CONFIG_FILE}.")
    print("Type 'help' for available commands.\n")

def display_prompt():
    """Displays the standard shell prompt."""
    print(f"\033[92m{USER}@{HOSTNAME}\033[0m:~\033[92m$\033[0m ", end='', flush=True)

def cmd_help():
    """Displays available commands."""
    print("GNU/Pi Gallery OS Commands:")
    print("  fw [status|block <ip>]   : Manage Persistent Firewall rules")
    print("  pm [list|add <site> <u/p>] : Persistent Password Manager")
    print("  backup                   : Run system backup simulation")
    print("  uptime                   : Show system uptime")
    print("  clear                    : Clear terminal")
    print("  reboot                   : Restart shell")
    print("  exit                     : Exit the Gallery OS shell")

def cmd_firewall(args):
    """Manages the simulated firewall rules."""
    args_list = args.split()
    
    if not args_list or args_list[0] == "status":
        print("--- Persistent Firewall Status: ACTIVE ---")
        print("Policy: ALLOW ALL incoming")
        print("Blocked IPs:")
        found = False
        for i, rule in enumerate(app_data['blockedIPs']):
            if rule['active']:
                print(f"  [{i}] [DROP] {rule['ip']}")
                found = True
        if not found:
            print("  (None)")
            
    elif args_list[0] == "block" and len(args_list) == 2:
        ip = args_list[1]
        if len(app_data['blockedIPs']) < MAX_BLOCKED_IPS:
            app_data['blockedIPs'].append({"ip": ip, "active": True})
            save_data(app_data)
            print(f"Firewall: Added rule to DROP {ip} (Persistent).")
        else:
            print("Firewall: Rule table full.")
    else:
        print("Usage: fw [status | block <ip>]")

def cmd_passman(args):
    """Manages the persistent password vault."""
    args_list = args.split()

    if not args_list or args_list[0] == "list":
        print("--- Persistent Password Vault ---")
        found = False
        for i, entry in enumerate(app_data['passwordStore']):
            print(f"  [{i}]: {entry['site']} | {entry['username']} | ********")
            found = True
        if not found:
            print("  (Vault empty)")
            
    elif args_list[0] == "add" and len(args_list) == 4:
        site, user, pass_ = args_list[1], args_list[2], args_list[3]
        
        if len(app_data['passwordStore']) < MAX_PASSWORDS:
            app_data['passwordStore'].append({
                "site": site,
                "username": user,
                "password": pass_
            })
            save_data(app_data)
            print(f"PassMan: Credentials saved for {site} (Persistent).")
        else:
            print("PassMan: Storage full.")
    else:
        print("Usage: pm [list | add <site> <user> <pass>]")

def cmd_backup():
    """Simulates a system backup."""
    print("Starting System Backup...")
    print("[....................] 0%")
    time.sleep(0.3)
    print("[#####...............] 25% - Compressing logs")
    time.sleep(0.5)
    print("[##########..........] 50% - Encrypting vault")
    time.sleep(0.4)
    print("[###############.....] 75% - Backing up files to disk")
    time.sleep(0.3)
    print("[####################] 100%")
    print("Backup Complete. Snapshot hash: 8f4a2c91")
    print(f"Data state saved to disk: {CONFIG_FILE}.")
    save_data(app_data)

def cmd_uptime():
    """Calculates and displays system uptime."""
    if app_data['startup_time'] == 0:
        print("Error: Startup time not recorded.")
        return

    delta = timedelta(seconds=int(time.time() - app_data['startup_time']))
    days = delta.days
    hours, remainder = divmod(delta.seconds, 3600)
    minutes, seconds = divmod(remainder, 60)
    
    uptime_str = f"up {days} days, {hours:02}:{minutes:02}:{seconds:02}"
    print(uptime_str)
    
# --- Main Shell Loop ---

def process_command(input_cmd):
    """Parses and executes the command."""
    if not input_cmd:
        return

    parts = input_cmd.split(maxsplit=1)
    cmd = parts[0].lower()
    args = parts[1] if len(parts) > 1 else ""

    if cmd == "help": cmd_help()
    elif cmd == "clear": clear_screen()
    elif cmd == "fw": cmd_firewall(args)
    elif cmd == "pm": cmd_passman(args)
    elif cmd == "backup": cmd_backup()
    elif cmd == "uptime": cmd_uptime()
    elif cmd == "ls": print(f"{CONFIG_FILE}  config.sys  firewall.rules")
    elif cmd == "reboot": 
        print("Rebooting Gallery OS shell...")
        time.sleep(1)
        run_bootstrap()
    elif cmd == "exit":
        print("Shutting down Gallery OS. Goodbye.")
        return True # Signal to exit the main loop
    else:
        print(f"gallery-pi: command not found: {cmd}")
    
    return False

def main_shell_loop():
    """The main loop for the Gallery OS shell."""
    run_bootstrap()
    
    running = True
    while running:
        try:
            display_prompt()
            input_cmd = input().strip()
            if input_cmd:
                if process_command(input_cmd):
                    running = False
        except EOFError:
            # Handle Ctrl+D
            print("\nShutting down Gallery OS. Goodbye.")
            running = False
        except KeyboardInterrupt:
            # Handle Ctrl+C
            print("\nType 'exit' to quit or 'help' for commands.")

if __name__ == "__main__":
    main_shell_loop()

    </textarea>
    
    <!-- SETUP GUIDE CONTENT (Raspberry Pi) -->
    <textarea id="hidden-code-pi-guide" style="display:none;">
SETUP INSTRUCTIONS FOR GALLERY OS (Raspberry Pi)

SUPPORTED DEVICES:
* All Raspberry Pi models running Raspberry Pi OS (formerly Raspbian) or similar Linux distribution.

SETUP INSTRUCTIONS:

1. OPEN TERMINAL: Open a Terminal window on your Raspberry Pi (or connect via SSH).
2. INSTALL PYTHON (if needed): Python 3 is usually pre-installed, but ensure it's up-to-date:
   sudo apt update
   sudo apt install python3 -y
3. SAVE THE FILE: Download the 'gallery_pi.py' file and save it to your home directory (e.g., /home/pi/).
4. RUN THE SCRIPT: Navigate to the directory where you saved the file and run it using Python 3:
   python3 gallery_pi.py
5. EXIT: To leave the shell, type 'exit'.

KEY DIFFERENCE (Persistence):
The Raspberry Pi version uses a file called 'gallery_os_data.json' in the same directory to **persistently store** your Firewall and Password Manager data, unlike the Arduino version which stores data only in RAM.

Commands: All commands (fw, pm, backup, uptime, etc.) function exactly like the Arduino version.

Terms & conditions: The Gallery team isn't liable for any loss of data. The system is not for high responsibility, only educational environments.
    </textarea>

    <script>
        function downloadCode(type) {
            let content, filename, mimeType;

            if (type === 'firmware') {
                content = document.getElementById('hidden-code-firmware').value;
                filename = 'GalleryOS.ino';
                mimeType = 'text/x-c++src';
            } else if (type === 'guide') {
                content = document.getElementById('hidden-code-guide').value;
                filename = 'GalleryOS_Arduino_Setup_Guide.txt';
                mimeType = 'text/plain';
            } else if (type === 'pi_app') {
                content = document.getElementById('hidden-code-pi-app').value;
                filename = 'gallery_pi.py';
                mimeType = 'text/x-python';
            } else if (type === 'pi_guide') {
                content = document.getElementById('hidden-code-pi-guide').value;
                filename = 'GalleryOS_Pi_Setup_Guide.txt';
                mimeType = 'text/plain';
            } else {
                return;
            }
            
            // Create a Blob (Binary Large Object) containing the text
            const blob = new Blob([content], { type: mimeType });
            
            // Create a temporary link element to trigger the download
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            
            // Programmatically click the link
            document.body.appendChild(link);
            link.click();
            
            // Cleanup
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
