<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery OS | GNU/Arduino</title>
    <style>
        :root {
            --bg-color: #0d1117;
            --text-color: #c9d1d9;
            --accent-color: #58a6ff;
            --terminal-bg: #161b22;
            --terminal-green: #2ea043;
            --border-color: #30363d;
            --font-mono: 'Courier New', Courier, monospace;
            --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-sans);
            line-height: 1.6;
        }

        /* --- Header & Hero --- */
        header {
            padding: 2rem 1rem;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .tagline {
            color: var(--accent-color);
            font-family: var(--font-mono);
            font-size: 1.1rem;
        }
        
        /* --- General Layout --- */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        /* --- Terminal Window Effect --- */
        .terminal-window {
            background: var(--terminal-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            max-width: 800px;
            margin: 2rem auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            text-align: left;
            overflow: hidden;
        }

        .terminal-header {
            background: #21262d;
            padding: 5px 15px;
            display: flex;
            gap: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; }
        .red { background: #ff5f56; }
        .yellow { background: #ffbd2e; }
        .green { background: #27c93f; }

        .terminal-body {
            padding: 20px;
            font-family: var(--font-mono);
            font-size: 0.9rem;
            color: var(--text-color);
            white-space: pre-wrap;
        }

        .prompt { color: var(--terminal-green); }
        .cursor { display: inline-block; width: 8px; height: 18px; background: var(--text-color); animation: blink 1s infinite; vertical-align: middle; }

        @keyframes blink { 50% { opacity: 0; } }
        
        /* --- Feature List --- */
        .feature-item {
            background: var(--terminal-bg);
            border: 1px solid var(--border-color);
            padding: 1.5rem;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .feature-item h3 { color: var(--accent-color); margin-bottom: 8px; }

        .feature-item ul {
            list-style-type: none;
            padding-left: 15px;
        }

        .feature-item ul li::before {
            content: '>';
            color: var(--terminal-green);
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
        }

        /* --- Download Section --- */
        .download-group {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .download-section {
            text-align: center;
            margin: 3rem 0;
            padding: 2rem;
            background: var(--terminal-bg);
            border-radius: 6px;
            border: 1px solid var(--accent-color);
            flex: 1 1 350px; /* Allow items to grow/shrink but maintain a minimum width */
        }
        
        .download-section h3 {
            margin-bottom: 10px;
        }

        .btn {
            display: inline-block;
            background: var(--terminal-green);
            color: white;
            padding: 15px 30px;
            font-size: 1.2rem;
            text-decoration: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            border: none;
            margin-top: 1rem;
        }

        .btn:hover {
            background: #26a641;
            transform: scale(1.05);
        }

        .note {
            background: #21262d;
            padding: 15px;
            border-left: 3px solid #ffaa00;
            margin: 2rem 0;
            font-size: 0.95rem;
        }
        
        .disclaimer {
            font-size: 0.85rem;
            color: #8b949e;
            text-align: center;
            margin-top: 2rem;
        }
    </style>
</head>
<body>

    <header>
        <h1>Gallery OS</h1>
        <p class="tagline">GNU/Arduino Shell Environment</p>
    </header>

    <div class="container">
        
        <div class="terminal-window">
            <div class="terminal-header">
                <span class="dot red"></span>
                <span class="dot yellow"></span>
                <span class="dot green"></span>
            </div>
            <div class="terminal-body">
                <div>Bootsrap Loader v1.0.4</div>
                <div>Loading Kernel modules... [OK]</div>
                <div>Mounting filesystem... [OK]</div>
                <div>Starting Firewall Service... [OK]</div>
                <br>
                <div>Welcome to Gallery OS (GNU/Arduino)</div>
                <div>System is ready.</div>
                <br>
                <span class="prompt">admin@gallery:/home/admin$</span> <span class="cursor"></span>
            </div>
        </div>
        
        <hr>

        <section id="features">
            <h2>Key Features</h2>
            
            <div class="feature-item">
                <h3>1. Bootstrap System</h3>
                <p>When you reset the **Arduino**, you will see a text-based startup sequence loading fake "kernel modules," giving the **authentic feel of a server booting up**.</p>
            </div>
            
            <div class="feature-item">
                <h3>2. The Terminal (CLI)</h3>
                <p>It uses a standard **admin@gallery:/home/admin$** prompt. It parses text strings so you can type natural commands.</p>
            </div>

            <div class="feature-item">
                <h3>3. Firewall (FW) Simulation</h3>
                <ul>
                    <li>**FW STATUS**: Shows active rules.</li>
                    <li>**FW BLOCK <IP>**: Adds an IP address to the mock blocklist.</li>
                </ul>
            </div>
            
            <div class="feature-item">
                <h3>4. Password Manager (PM)</h3>
                <ul>
                    <li>**PM ADD <SITE> <USER> <PASS>**: Stores credentials in the **Arduino's RAM**.</li>
                    <li>**PM LIST**: Lists stored sites (hiding the actual password for "security").</li>
                </ul>
            </div>
            
            <div class="feature-item">
                <h3>5. Backup System (Backup)</h3>
                <p>Visualizes a progress bar and simulates a system dump.</p>
            </div>

            <div class="note">
                **IMPORTANT NOTE ON DATA:** Since the Arduino R4 lacks a file system by default (unless using an SD card shield), the data in the Password Manager and Firewall is stored in **RAM** and will **reset if the board loses power**.
            </div>
        </section>

        <hr>

        <section id="devices">
            <h2>Supported Devices & Setup</h2>
            <p>Gallery OS is tailored for the latest Arduino R4 architecture.</p>
            <br>
                        <br>
            <div class="feature-item">
                <h3>Supported Hardware</h3>
                <p>Arduino UNO R4 WIFI</p>
                <p>Arduino NANO R4</p>
            </div>
            
            <div class="download-group">
                <div class="download-section">
                    <h3>Download Firmware Code</h3>
                    <p>The core C++ code (.ino file) for Gallery OS.</p>
                    <button class="btn" onclick="downloadCode('firmware')">Download GalleryOS.ino</button>
                </div>
                
                <div class="download-section">
                    <h3>Download Setup Guide</h3>
                    <p>Detailed steps for setup and use (PDF format).</p>
                    <button class="btn" onclick="downloadCode('guide')">Download Setup Guide</button>
                </div>
            </div>
        </section>
        
        <hr>
        
        <p class="disclaimer">Terms & conditions: The Gallery team isn't liable for any loss of data. The system is not for high responsibility, only educational environments.</p>

    </div>

    <textarea id="hidden-code-firmware" style="display:none;">
/*
  Gallery OS - Linux-like Shell Environment for Arduino R4
  Target Hardware: Arduino Uno R4 (Minima/WiFi), Arduino Nano R4
   
  Features:
  - Bootstrap sequence
  - Command Line Interface (CLI)
  - Simulated Firewall
  - In-Memory Password Manager
  - Mock Backup System
   
  Note: This is a bare-metal firmware that mimics Linux behavior.
  It does not use a Linux kernel due to hardware constraints (No MMU, limited RAM).
*/

#include <Arduino.h>

// --- Configuration ---
#define HOSTNAME "gallery"
#define USER "admin"
#define BAUD_RATE 115200
#define MAX_PASSWORDS 10
#define MAX_BLOCKED_IPS 10

// --- Data Structures ---

struct PasswordEntry {
  String site;
  String username;
  String password;
  bool active;
};

struct FirewallRule {
  String ip;
  bool active;
};

// --- Globals ---
PasswordEntry passwordStore[MAX_PASSWORDS];
FirewallRule blockedIPs[MAX_BLOCKED_IPS];
bool isLoggedIn = false;
String currentDir = "/home/admin";

// --- Function Prototypes ---
void runBootstrap();
void displayPrompt();
void processCommand(String input);
void cmdHelp();
void cmdFirewall(String args);
void cmdPassMan(String args);
void cmdBackup();
void cmdClear();
void cmdUptime();

void setup() {
  Serial.begin(BAUD_RATE);
  while (!Serial) {
    ; // Wait for serial port to connect
  }
   
  // Initialize data
  blockedIPs[0] = {"192.168.1.55", true}; // Default rule
   
  runBootstrap();
}

void loop() {
  if (Serial.available() > 0) {
    String input = Serial.readStringUntil('\n');
    input.trim();
    if (input.length() > 0) {
      Serial.println(input); // Echo command
      processCommand(input);
      displayPrompt();
    }
  }
}

// --- Bootstrap System ---
void runBootstrap() {
  Serial.println("\033[2J\033[H"); // ANSI Clear Screen
  Serial.println(F("Bootsrap Loader v1.0.4"));
  delay(500);
  Serial.print(F("Loading Kernel modules..."));
  delay(800);
  Serial.println(F(" [OK]"));
  Serial.print(F("Mounting filesystem..."));
  delay(600);
  Serial.println(F(" [OK]"));
  Serial.print(F("Starting Firewall Service..."));
  delay(400);
  Serial.println(F(" [OK]"));
  Serial.print(F("Initializing Password Vault..."));
  delay(400);
  Serial.println(F(" [OK]"));
   
  Serial.println(F("\nWelcome to Gallery OS (GNU/Arduino)"));
  Serial.println(F("System is ready. Type 'help' for available commands.\n"));
   
  displayPrompt();
}

void displayPrompt() {
  Serial.print(USER);
  Serial.print("@");
  Serial.print(HOSTNAME);
  Serial.print(":");
  Serial.print(currentDir);
  Serial.print("$ ");
}

// --- Terminal / Command Parser ---
void processCommand(String input) {
  int spaceIndex = input.indexOf(' ');
  String cmd = (spaceIndex == -1) ? input : input.substring(0, spaceIndex);
  String args = (spaceIndex == -1) ? "" : input.substring(spaceIndex + 1);

  if (cmd == "help") cmdHelp();
  else if (cmd == "clear") cmdClear();
  else if (cmd == "fw") cmdFirewall(args);
  else if (cmd == "pm") cmdPassMan(args);
  else if (cmd == "backup") cmdBackup();
  else if (cmd == "uptime") cmdUptime();
  else if (cmd == "ls") Serial.println(F("passwords.db  config.sys  firewall.rules"));
  else if (cmd == "reboot") { Serial.println(F("Rebooting...")); delay(1000); runBootstrap(); }
  else {
    Serial.print(F("gallery: command not found: "));
    Serial.println(cmd);
  }
}

void cmdHelp() {
  Serial.println(F("GNU/Arduino Gallery OS Commands:"));
  Serial.println(F("  fw [status|block <ip>]   : Manage Firewall"));
  Serial.println(F("  pm [list|add <site> <u/p>] : Password Manager"));
  Serial.println(F("  backup                   : Run system backup"));
  Serial.println(F("  uptime                   : System uptime"));
  Serial.println(F("  clear                    : Clear terminal"));
  Serial.println(F("  reboot                   : Restart system"));
}

// --- Firewall Module ---
void cmdFirewall(String args) {
  if (args == "" || args == "status") {
    Serial.println(F("--- Firewall Status: ACTIVE ---"));
    Serial.println(F("Policy: ALLOW ALL incoming"));
    Serial.println(F("Blocked IPs:"));
    bool found = false;
    for (int i = 0; i < MAX_BLOCKED_IPS; i++) {
      if (blockedIPs[i].active) {
        Serial.print(F("  [DROP] "));
        Serial.println(blockedIPs[i].ip);
        found = true;
      }
    }
    if (!found) Serial.println(F("  (None)"));
  } else if (args.startsWith("block ")) {
    String ip = args.substring(6);
    for (int i = 0; i < MAX_BLOCKED_IPS; i++) {
      if (!blockedIPs[i].active) {
        blockedIPs[i].ip = ip;
        blockedIPs[i].active = true;
        Serial.print(F("Firewall: Added rule to DROP "));
        Serial.println(ip);
        return;
      }
    }
    Serial.println(F("Firewall: Rule table full."));
  } else {
    Serial.println(F("Usage: fw [status | block <ip>]"));
  }
}

// --- Password Manager Module ---
void cmdPassMan(String args) {
  if (args == "" || args == "list") {
    Serial.println(F("--- Password Vault ---"));
    bool found = false;
    for (int i = 0; i < MAX_PASSWORDS; i++) {
      if (passwordStore[i].active) {
        Serial.print(i);
        Serial.print(F(": "));
        Serial.print(passwordStore[i].site);
        Serial.print(F(" | "));
        Serial.println("********"); // Security feature: don't show pass on list
        found = true;
      }
    }
    if (!found) Serial.println(F("  (Vault empty)"));
  } else if (args.startsWith("add ")) {
    // Expected format: pm add google myUser myPass
    int firstSpace = args.indexOf(' ');
    int secondSpace = args.indexOf(' ', firstSpace + 1);
    int thirdSpace = args.indexOf(' ', secondSpace + 1);
     
    if (firstSpace == -1 || secondSpace == -1 || thirdSpace == -1) {
       Serial.println(F("Usage: pm add <site> <user> <pass>"));
       return;
    }

    String site = args.substring(4, secondSpace);
    String user = args.substring(secondSpace + 1, thirdSpace);
    String pass = args.substring(thirdSpace + 1);

    for (int i = 0; i < MAX_PASSWORDS; i++) {
      if (!passwordStore[i].active) {
        passwordStore[i].site = site;
        passwordStore[i].username = user;
        passwordStore[i].password = pass;
        passwordStore[i].active = true;
        Serial.print(F("PassMan: Credentials saved for "));
        Serial.println(site);
        return;
      }
    }
    Serial.println(F("PassMan: Storage full."));
  } else {
    Serial.println(F("Usage: pm [list | add <site> <user> <pass>]"));
  }
}

// --- Backup System ---
void cmdBackup() {
  Serial.println(F("Starting System Backup..."));
  Serial.println(F("[....................] 0%"));
  delay(300);
  Serial.println(F("[#####...............] 25% - Compressing logs"));
  delay(500);
  Serial.println(F("[##########..........] 50% - Encrypting vault"));
  delay(400);
  Serial.println(F("[###############.....] 75% - Uploading to serial"));
  delay(300);
  Serial.println(F("[####################] 100%"));
  Serial.println(F("Backup Complete. Snapshot hash: 8f4a2c91"));
  Serial.println(F("Backup saved to local storage simulation."));
}

void cmdClear() {
  Serial.println("\033[2J\033[H");
}

void cmdUptime() {
  unsigned long runMillis = millis();
  unsigned long allSeconds = runMillis / 1000;
  int runHours = allSeconds / 3600;
  int runMinutes = (allSeconds % 3600) / 60;
  int runSeconds = allSeconds % 60;

  Serial.print(F("up "));
  Serial.print(runHours);
  Serial.print(F(":"));
  if (runMinutes < 10) Serial.print("0");
  Serial.print(runMinutes);
  Serial.print(F(":"));
  if (runSeconds < 10) Serial.print("0");
  Serial.println(runSeconds);
}
    </textarea>
    
    <textarea id="hidden-code-guide" style="display:none;">
SETUP INSTRUCTIONS FOR GALLERY OS

SUPPORTED DEVICES:
* Arduino UNO R4 WIFI
* Arduino NANO R4

SETUP INSTRUCTIONS:
1. Open the Arduino IDE.
2. Select your board (Arduino UNO R4 WIFI/Minima or NANO R4).
3. Copy the code from the 'GalleryOS.ino' file into a new sketch.
4. Upload it to the board.
5. Open the Serial Monitor (Tools > Serial Monitor).
6. Set the Baud Rate to 115200 and Line Ending to Newline.

KEY FEATURES OF GALLERY OS:
1. BOOTSTRAP SYSTEM: When you reset the Arduino, you will see a text-based startup sequence loading fake "kernel modules," giving the authentic feel of a server booting up.
2. THE TERMINAL: It uses a standard admin@gallery:/home/admin$ prompt. It parses text strings so you can type natural commands.
3. FIREWALL (FW):
    * FW STATUS: Shows active rules.
    * FW BLOCK <IP>: Adds an IP address to the mock blocklist.
4. PASSWORD MANAGER (PM):
    * PM ADD <SITE> <USER> <PASS>: Stores credentials in the Arduino's RAM.
    * PM LIST: Lists stored sites (hiding the actual password for "security").
5. BACKUP SYSTEM (BACKUP): Visualizes a progress bar and simulates a system dump.

NOTE: Since the Arduino R4 lacks a file system by default (unless using an SD card shield), the data in the Password Manager and Firewall is stored in RAM and will reset if the board loses power.

Terms & conditions: The Gallery team isn't liable for any loss of data. The system is not for high responsibility, only educational environments.
    </textarea>

    <script>
        function downloadCode(type) {
            let content, filename, mimeType;

            if (type === 'firmware') {
                content = document.getElementById('hidden-code-firmware').value;
                filename = 'GalleryOS.ino';
                mimeType = 'text/x-c++src';
            } else if (type === 'guide') {
                content = document.getElementById('hidden-code-guide').value;
                filename = 'GalleryOS_Setup_Guide.txt';
                mimeType = 'text/plain';
            } else {
                return;
            }
            
            // Create a Blob (Binary Large Object) containing the text
            const blob = new Blob([content], { type: mimeType });
            
            // Create a temporary link element to trigger the download
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            
            // Programmatically click the link
            document.body.appendChild(link);
            link.click();
            
            // Cleanup
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
